   <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBiCAjf5-UIfndcAs33IeuZu0nOQlPryxI",
            authDomain: "negocio-43657.firebaseapp.com",
            projectId: "negocio-43657",
            storageBucket: "negocio-43657.appspot.com",
            messagingSenderId: "751435187048",
            appId: "1:751435187048:web:59e69bad56c1deacf98cdd",
            measurementId: "G-ECL4EFRXMC"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const globalDoc = db.collection("finance").doc("globalData");

        // State
        let currentUser = null;
        let incomeData = {};
        let expenseData = {};
        let chart = null;
        let selectedType = 'income';

        // User accounts
        const users = {
            Rafael: { password: 'Fera', role: 'client' },
            Pedro: { password: 'Dias', role: 'client' },
            Rodrigo: { password: 'Digo', role: 'admin' }
        };

        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const dashboardScreen = document.getElementById('dashboardScreen');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const currentUsername = document.getElementById('currentUsername');
        const userRole = document.getElementById('userRole');
        const adminPanel = document.getElementById('adminPanel');
        const clientPanel = document.getElementById('clientPanel');
        const statistics = document.getElementById('statistics');
        const btnIncome = document.getElementById('btnIncome');
        const btnExpense = document.getElementById('btnExpense');
        const saveIncomeBtn = document.getElementById('saveIncomeBtn');
        const saveExpenseBtn = document.getElementById('saveExpenseBtn');
        const editError = document.getElementById('editError');
        const editSuccess = document.getElementById('editSuccess');
        const dataList = document.getElementById('dataList');
        const lastUpdate = document.getElementById('lastUpdate');

        // Real-time listener for Firebase
        globalDoc.onSnapshot((doc) => {
            console.log('Firebase snapshot received!', doc.exists);
            if (doc.exists) {
                const data = doc.data();
                incomeData = data.income || {};
                expenseData = data.expense || {};
                
                console.log('Income data:', incomeData);
                console.log('Expense data:', expenseData);
                
                if (currentUser) {
                    createChart();
                    updateStatistics();
                    if (currentUser.role === 'admin') {
                        updateDataList();
                    }
                }

                const updateTime = data.lastUpdated?.toDate() || new Date();
                lastUpdate.textContent = `Updated: ${updateTime.toLocaleTimeString()}`;
            }
        });

        // Save to Firebase
        async function saveToFirebase() {
            try {
                console.log('Saving to Firebase...', { income: incomeData, expense: expenseData });
                await globalDoc.set({
                    income: incomeData,
                    expense: expenseData,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('Save successful!');
                return true;
            } catch (error) {
                console.error('Error saving to Firebase:', error);
                return false;
            }
        }

        // Login
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users[username];
            if (user && user.password === password) {
                currentUser = { username, role: user.role };
                showDashboard();
            } else {
                showMessage(loginError, 'Invalid username or password', 'error');
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('editDay').value = '';
            document.getElementById('editValue').value = '';
            hideMessage(loginError);
            hideMessage(editError);
            hideMessage(editSuccess);
            loginScreen.classList.remove('hidden');
            dashboardScreen.classList.add('hidden');
        });

        // Show dashboard
        function showDashboard() {
            loginScreen.classList.add('hidden');
            dashboardScreen.classList.remove('hidden');
            hideMessage(loginError);

            currentUsername.textContent = currentUser.username;
            userRole.textContent = currentUser.role === 'admin' ? 'Administrator' : 'Client';

            if (currentUser.role === 'admin') {
                adminPanel.classList.remove('hidden');
                clientPanel.classList.add('hidden');
                updateDataList();
            } else {
                adminPanel.classList.add('hidden');
                clientPanel.classList.remove('hidden');
            }

            createChart();
            updateStatistics();
        }

        // Type selection
        btnIncome.addEventListener('click', () => {
            selectedType = 'income';
            btnIncome.classList.add('active-income');
            btnIncome.classList.remove('bg-gray-700', 'border-gray-600');
            btnExpense.classList.remove('active-expense');
            btnExpense.classList.add('bg-gray-700', 'border-gray-600');
            updateDataList();
        });

        btnExpense.addEventListener('click', () => {
            selectedType = 'expense';
            btnExpense.classList.add('active-expense');
            btnExpense.classList.remove('bg-gray-700', 'border-gray-600');
            btnIncome.classList.remove('active-income');
            btnIncome.classList.add('bg-gray-700', 'border-gray-600');
            updateDataList();
        });

        // Save transaction
        saveIncomeBtn.addEventListener('click', () => saveTransaction('income'));
        saveExpenseBtn.addEventListener('click', () => saveTransaction('expense'));

        async function saveTransaction(type) {
            hideMessage(editSuccess);
            hideMessage(editError);

            const day = parseInt(document.getElementById('editDay').value);
            const value = parseFloat(document.getElementById('editValue').value);

            if (!day || !value) {
                showMessage(editError, 'Please fill in both day and amount', 'error');
                return;
            }

            if (day < 1 || day > 365) {
                showMessage(editError, 'Day must be between 1 and 365', 'error');
                return;
            }

            if (value <= 0) {
                showMessage(editError, 'Amount must be greater than 0', 'error');
                return;
            }

            if (type === 'income') {
                incomeData[day] = (incomeData[day] || 0) + value;
            } else {
                expenseData[day] = (expenseData[day] || 0) + value;
            }

            const saved = await saveToFirebase();
            if (saved) {
                const typeText = type === 'income' ? 'ðŸ’° Income' : 'ðŸ’¸ Expense';
                const totalValue = type === 'income' ? incomeData[day] : expenseData[day];
                showMessage(editSuccess, `${typeText} added: Day ${day}, +$${value.toFixed(2)} (Total: $${totalValue.toFixed(2)})`, 'success');
                
                document.getElementById('editDay').value = '';
                document.getElementById('editValue').value = '';

                setTimeout(() => hideMessage(editSuccess), 3000);
            } else {
                showMessage(editError, 'Error saving data. Please try again.', 'error');
            }
        }

        // Delete transaction
        window.deleteTransaction = async function(type, day) {
            if (type === 'income') {
                delete incomeData[day];
            } else {
                delete expenseData[day];
            }

            const saved = await saveToFirebase();
            if (saved) {
                showMessage(editSuccess, `Day ${day} data removed successfully!`, 'success');
                setTimeout(() => hideMessage(editSuccess), 3000);
            }
        };

        // Update data list
        function updateDataList() {
            const data = selectedType === 'income' ? incomeData : expenseData;
            const color = selectedType === 'income' ? '#60A5FA' : '#F87171';
            const emoji = selectedType === 'income' ? 'ðŸ’°' : 'ðŸ’¸';
            const label = selectedType === 'income' ? 'Income' : 'Expense';

            if (Object.keys(data).length === 0) {
                dataList.innerHTML = `<p class="text-gray-400 text-center py-4">No ${label.toLowerCase()} recorded</p>`;
                return;
            }

            const sortedDays = Object.keys(data).map(Number).sort((a, b) => a - b);
            let html = `<h3 class="font-semibold mb-3" style="color: ${color};">${emoji} ${label}s:</h3>`;

            sortedDays.forEach(day => {
                html += `
                    <div class="flex justify-between items-center bg-gray-700 rounded-lg p-3 mb-2">
                        <div>
                            <div class="font-medium" style="color: ${color};">Day ${day}</div>
                            <div class="text-sm text-gray-300">$${data[day].toFixed(2)}</div>
                        </div>
                        <button onclick="deleteTransaction('${selectedType}', ${day})" class="bg-red-900/50 hover:bg-red-900 text-red-200 px-3 py-1 rounded text-sm transition">Delete</button>
                    </div>
                `;
            });

            dataList.innerHTML = html;
        }

        // Create chart
        function createChart() {
            const ctx = document.getElementById('lineChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            const hasIncome = Object.keys(incomeData).length > 0;
            const hasExpense = Object.keys(expenseData).length > 0;

            if (!hasIncome && !hasExpense) {
                chart = new Chart(ctx, {
                    type: 'line',
                    data: { 
                        labels: [1, 30, 60, 90, 120, 150, 180, 210, 240, 270, 300, 330, 365], 
                        datasets: [] 
                    },
                    options: getChartOptions()
                });
                return;
            }

            // Get all days that have data
            const allDays = new Set([
                ...Object.keys(incomeData).map(Number),
                ...Object.keys(expenseData).map(Number)
            ]);
            const maxDay = Math.max(...allDays, 30);
            const labels = Array.from({length: maxDay}, (_, i) => i + 1);

            const datasets = [];

            if (hasIncome) {
                datasets.push({
                    label: 'ðŸ’° Income',
                    data: labels.map(day => incomeData[day] || 0),
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: '#3B82F6',
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    tension: 0.3,
                    fill: true
                });
            }

            if (hasExpense) {
                datasets.push({
                    label: 'ðŸ’¸ Expenses',
                    data: labels.map(day => expenseData[day] || 0),
                    borderColor: '#EF4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: '#EF4444',
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    tension: 0.3,
                    fill: true
                });
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: getChartOptions()
            });
        }

        function getChartOptions() {
            return {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    mode: 'index',
                    intersect: false,
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#D1D5DB',
                            font: { size: 14, weight: 'bold' }
                        }
                    },
                    tooltip: {
                        backgroundColor: '#374151',
                        titleColor: '#F3F4F6',
                        bodyColor: '#F3F4F6',
                        borderColor: '#4B5563',
                        borderWidth: 1,
                        callbacks: {
                            label: (context) => `${context.dataset.label}: $${context.parsed.y.toFixed(2)}`
                        }
                    }
                },
                scales: {
                    x: {
                        title: { 
                            display: true, 
                            text: 'Days', 
                            color: '#9CA3AF',
                            font: { size: 14 }
                        },
                        ticks: { 
                            color: '#9CA3AF',
                            maxTicksLimit: 12
                        },
                        grid: { color: '#374151' }
                    },
                    y: {
                        title: { 
                            display: true, 
                            text: 'Amount ($)', 
                            color: '#9CA3AF',
                            font: { size: 14 }
                        },
                        ticks: { 
                            color: '#9CA3AF',
                            callback: function(value) {
                                return '$' + value.toFixed(0);
                            }
                        },
                        grid: { color: '#374151' },
                        beginAtZero: true
                    }
                }
            };
        }

        // Update statistics
        function updateStatistics() {
            const hasIncome = Object.keys(incomeData).length > 0;
            const hasExpense = Object.keys(expenseData).length > 0;

            if (!hasIncome && !hasExpense) {
                statistics.innerHTML = '<p class="text-gray-400">No data available yet.</p>';
                return;
            }

            let html = '';

            if (hasIncome) {
                const totalIncome = Object.values(incomeData).reduce((sum, val) => sum + val, 0);
                const daysIncome = Object.keys(incomeData).length;
                html += `
                    <div class="bg-blue-900/20 border border-blue-700/30 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-blue-400 font-semibold">ðŸ’° Income</span>
                            <span class="text-xs text-gray-400">${daysIncome} days</span>
                        </div>
                        <div class="text-2xl font-bold text-blue-400">$${totalIncome.toFixed(2)}</div>
                    </div>
                `;
            }

            if (hasExpense) {
                const totalExpense = Object.values(expenseData).reduce((sum, val) => sum + val, 0);
                const daysExpense = Object.keys(expenseData).length;
                html += `
                    <div class="bg-red-900/20 border border-red-700/30 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-red-400 font-semibold">ðŸ’¸ Expenses</span>
                            <span class="text-xs text-gray-400">${daysExpense} days</span>
                        </div>
                        <div class="text-2xl font-bold text-red-400">$${totalExpense.toFixed(2)}</div>
                    </div>
                `;
            }

            if (hasIncome && hasExpense) {
                const totalIncome = Object.values(incomeData).reduce((sum, val) => sum + val, 0);
                const totalExpense = Object.values(expenseData).reduce((sum, val) => sum + val, 0);
                const balance = totalIncome - totalExpense;
                const balanceColor = balance >= 0 ? '#10B981' : '#EF4444';
                const bgColor = balance >= 0 ? 'bg-green-900/20 border-green-700/30' : 'bg-red-900/20 border-red-700/30';
                
                html += `
                    <div class="${bgColor} border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-gray-300 font-semibold">ðŸ“Š Balance</span>
                        </div>
                        <div class="text-2xl font-bold" style="color: ${balanceColor};">$${balance.toFixed(2)}</div>
                    </div>
                `;
            }

            statistics.innerHTML = html;
        }

        // Message helpers
        function showMessage(element, message, type) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function hideMessage(element) {
            element.classList.add('hidden');
        }
    </script>
</body>
</html>
