<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Financeiro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        .container {
            min-height: 100vh;
            padding: 1.5rem;
        }

        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .login-box {
            background: #374151;
            border-radius: 0.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            padding: 2rem;
            width: 100%;
            max-width: 28rem;
        }

        .login-title {
            font-size: 1.875rem;
            font-weight: bold;
            color: #f3f4f6;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            color: #d1d5db;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
        }

        input, select {
            width: 100%;
            padding: 0.75rem 1rem;
            background: #4b5563;
            border: 1px solid #6b7280;
            border-radius: 0.5rem;
            color: #f3f4f6;
            font-size: 1rem;
        }

        input:focus, select:focus {
            outline: none;
            ring: 2px;
            ring-color: #9ca3af;
        }

        .error-message {
            background: #7f1d1d;
            color: #fecaca;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .success-message {
            background: #14532d;
            color: #bbf7d0;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .btn {
            width: 100%;
            padding: 0.75rem;
            font-weight: bold;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: #4b5563;
            color: #f3f4f6;
        }

        .btn-primary:hover {
            background: #6b7280;
        }

        .btn-secondary {
            background: #4b5563;
            color: #f3f4f6;
        }

        .btn-secondary:hover {
            background: #6b7280;
        }

        .btn-green {
            background: #16a34a;
            color: white;
            margin-bottom: 0.5rem;
        }

        .btn-green:hover {
            background: #22c55e;
        }

        .btn-red {
            background: #dc2626;
            color: white;
        }

        .btn-red:hover {
            background: #ef4444;
        }

        .test-users {
            margin-top: 1.5rem;
            color: #9ca3af;
            font-size: 0.875rem;
            text-align: center;
        }

        .test-users p {
            margin-bottom: 0.25rem;
        }

        .header {
            background: #374151;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            padding: 1rem;
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #f3f4f6;
        }

        .header-subtitle {
            color: #d1d5db;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        .badge {
            display: inline-block;
            margin-left: 0.5rem;
            padding: 0.25rem 0.5rem;
            background: #4b5563;
            border-radius: 0.25rem;
            font-size: 0.75rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }

        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 2fr 1fr;
            }
        }

        .card {
            background: #374151;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #f3f4f6;
            margin-bottom: 1rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
        }

        .info-box {
            padding: 1rem;
            background: #4b5563;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }

        .info-box h3 {
            color: #e5e7eb;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .info-box p, .info-box ul {
            color: #d1d5db;
            font-size: 0.875rem;
        }

        .info-box ul {
            list-style: none;
        }

        .info-box ul li {
            margin-bottom: 0.25rem;
        }

        .hidden {
            display: none !important;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            opacity: 1;
        }

        .data-type-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .data-type-btn {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #4b5563;
            background: #4b5563;
            color: #d1d5db;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .data-type-btn.active-ganho {
            border-color: #3b82f6;
            background: #1e40af;
            color: white;
        }

        .data-type-btn.active-gasto {
            border-color: #ef4444;
            background: #b91c1c;
            color: white;
        }

        .data-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #4b5563;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .data-item-info {
            flex: 1;
        }

        .data-item-type {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .data-item-details {
            font-size: 0.875rem;
            color: #d1d5db;
        }

        .btn-delete {
            background: #7f1d1d;
            color: #fecaca;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .btn-delete:hover {
            background: #991b1b;
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h1 class="login-title">Sistema Financeiro</h1>
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Login</label>
                    <input type="text" id="username" placeholder="Digite seu login" autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Senha</label>
                    <input type="password" id="password" placeholder="Digite sua senha" autocomplete="current-password">
                </div>
                <div id="loginError" class="error-message hidden"></div>
                <button type="submit" class="btn btn-primary">Entrar</button>
            </form>
            <div class="test-users">
                <p style="margin-bottom: 0.5rem;">Usu√°rios de teste:</p>
                <p>Rafael / Fera (Cliente)</p>
                <p>Pedro / Dias (Cliente)</p>
                <p>Rodrigo / Digo (Admin)</p>
            </div>
        </div>
    </div>

    <div id="dashboardScreen" class="container hidden">
        <div class="header">
            <div>
                <h1 class="header-title">Dashboard Financeiro</h1>
                <p class="header-subtitle">
                    Bem-vindo, <span id="currentUsername"></span>
                    <span class="badge" id="userRole"></span>
                </p>
            </div>
            <button id="logoutBtn" class="btn btn-secondary" style="width: auto; padding: 0.5rem 1rem;">
                ‚Üê Sair
            </button>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <h2 class="card-title">Valores por Dia (Ganhos e Gastos)</h2>
                <div class="chart-container">
                    <canvas id="lineChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title" id="sidePanelTitle">Editar Dados</h2>
                
                <div id="adminPanel" class="hidden">
                    <div class="data-type-selector">
                        <button type="button" class="data-type-btn active-ganho" id="btnGanho">üí∞ Ganho</button>
                        <button type="button" class="data-type-btn" id="btnGasto">üí∏ Gasto</button>
                    </div>

                    <div class="form-group">
                        <label for="editDay">Dia</label>
                        <input type="number" id="editDay" min="1" max="365" placeholder="Ex: 10">
                    </div>

                    <div class="form-group">
                        <label for="editValue">Valor (R$)</label>
                        <input type="number" id="editValue" step="0.01" min="0" placeholder="Ex: 12.00">
                    </div>

                    <div id="editError" class="error-message hidden"></div>
                    <div id="editSuccess" class="success-message hidden"></div>

                    <button id="saveGanhoBtn" class="btn btn-green">üí∞ Adicionar Ganho</button>
                    <button id="saveGastoBtn" class="btn btn-red">üí∏ Adicionar Gasto</button>

                    <div class="info-box" style="margin-top: 1.5rem;">
                        <h3>Instru√ß√µes:</h3>
                        <ul>
                            <li>‚Ä¢ Selecione o tipo (Ganho ou Gasto)</li>
                            <li>‚Ä¢ Digite o dia (Ex: 10)</li>
                            <li>‚Ä¢ Digite o valor para aquele dia</li>
                            <li>‚Ä¢ Clique em Adicionar</li>
                            <li>‚Ä¢ ‚ú® Valores no mesmo dia s√£o SOMADOS!</li>
                            <li>‚Ä¢ Os dados ficam salvos permanentemente</li>
                        </ul>
                    </div>

                    <div id="dataList" class="data-list"></div>
                </div>

                <div id="clientPanel" class="hidden">
                    <div class="info-box">
                        <p>Voc√™ est√° visualizando o gr√°fico em tempo real. Apenas administradores podem editar os dados.</p>
                    </div>
                    <div class="info-box">
                        <h3>Estat√≠sticas:</h3>
                        <div id="statistics"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let ganhosData = {};
        let gastosData = {};
        let chart = null;
        let selectedType = 'ganho';

        const users = {
            Rafael: { password: 'Fera', role: 'cliente' },
            Pedro: { password: 'Dias', role: 'cliente' },
            Rodrigo: { password: 'Digo', role: 'admin' }
        };

        const loginScreen = document.getElementById('loginScreen');
        const dashboardScreen = document.getElementById('dashboardScreen');
        const loginForm = document.getElementById('loginForm');
        const loginError = document.getElementById('loginError');
        const logoutBtn = document.getElementById('logoutBtn');
        const currentUsername = document.getElementById('currentUsername');
        const userRole = document.getElementById('userRole');
        const adminPanel = document.getElementById('adminPanel');
        const clientPanel = document.getElementById('clientPanel');
        const sidePanelTitle = document.getElementById('sidePanelTitle');
        const editError = document.getElementById('editError');
        const editSuccess = document.getElementById('editSuccess');
        const saveGanhoBtn = document.getElementById('saveGanhoBtn');
        const saveGastoBtn = document.getElementById('saveGastoBtn');
        const statistics = document.getElementById('statistics');
        const btnGanho = document.getElementById('btnGanho');
        const btnGasto = document.getElementById('btnGasto');
        const dataList = document.getElementById('dataList');

        function loadData() {
            const ganhosJSON = localStorage.getItem('financial-ganhos');
            if (ganhosJSON) {
                ganhosData = JSON.parse(ganhosJSON);
                console.log('Ganhos carregados:', ganhosData);
            } else {
                ganhosData = {};
            }

            const gastosJSON = localStorage.getItem('financial-gastos');
            if (gastosJSON) {
                gastosData = JSON.parse(gastosJSON);
                console.log('Gastos carregados:', gastosData);
            } else {
                gastosData = {};
            }
        }

        function saveDataToStorage() {
            try {
                localStorage.setItem('financial-ganhos', JSON.stringify(ganhosData));
                localStorage.setItem('financial-gastos', JSON.stringify(gastosData));
                console.log('Dados salvos com sucesso!');
                return true;
            } catch (error) {
                console.error('Erro ao salvar dados:', error);
                return false;
            }
        }

        btnGanho.addEventListener('click', () => {
            selectedType = 'ganho';
            btnGanho.classList.add('active-ganho');
            btnGanho.classList.remove('active-gasto');
            btnGasto.classList.remove('active-ganho', 'active-gasto');
            updateDataList();
        });

        btnGasto.addEventListener('click', () => {
            selectedType = 'gasto';
            btnGasto.classList.add('active-gasto');
            btnGasto.classList.remove('active-ganho');
            btnGanho.classList.remove('active-ganho', 'active-gasto');
            updateDataList();
        });

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const user = users[username];
            if (user && user.password === password) {
                currentUser = { username, role: user.role };
                loadData();
                showDashboard();
            } else {
                showError(loginError, 'Login ou senha incorretos');
            }
        });

        logoutBtn.addEventListener('click', () => {
            currentUser = null;
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('editDay').value = '';
            document.getElementById('editValue').value = '';
            hideError(loginError);
            hideError(editError);
            hideError(editSuccess);
            loginScreen.classList.remove('hidden');
            dashboardScreen.classList.add('hidden');
        });

        function showDashboard() {
            loginScreen.classList.add('hidden');
            dashboardScreen.classList.remove('hidden');
            hideError(loginError);

            currentUsername.textContent = currentUser.username;
            userRole.textContent = currentUser.role === 'admin' ? 'Administrador' : 'Cliente';

            if (currentUser.role === 'admin') {
                sidePanelTitle.textContent = 'Editar Dados';
                adminPanel.classList.remove('hidden');
                clientPanel.classList.add('hidden');
                updateDataList();
            } else {
                sidePanelTitle.textContent = 'Informa√ß√µes';
                adminPanel.classList.add('hidden');
                clientPanel.classList.remove('hidden');
                updateStatistics();
            }

            createChart();
        }

        function updateDataList() {
            const data = selectedType === 'ganho' ? ganhosData : gastosData;
            const color = selectedType === 'ganho' ? '#60A5FA' : '#F87171';
            const emoji = selectedType === 'ganho' ? 'üí∞' : 'üí∏';
            const label = selectedType === 'ganho' ? 'Ganho' : 'Gasto';

            if (Object.keys(data).length === 0) {
                dataList.innerHTML = `<p style="color: #9CA3AF; text-align: center; padding: 1rem;">Nenhum ${label.toLowerCase()} cadastrado</p>`;
                return;
            }

            const sortedDays = Object.keys(data).map(Number).sort((a, b) => a - b);
            let html = `<h3 style="color: ${color}; margin-bottom: 0.75rem;">${emoji} ${label}s Cadastrados:</h3>`;

            sortedDays.forEach(day => {
                html += `
                    <div class="data-item">
                        <div class="data-item-info">
                            <div class="data-item-type" style="color: ${color};">Dia ${day}</div>
                            <div class="data-item-details">R$ ${data[day].toFixed(2)}</div>
                        </div>
                        <button class="btn-delete" onclick="deleteData('${selectedType}', ${day})">üóëÔ∏è Excluir</button>
                    </div>
                `;
            });

            dataList.innerHTML = html;
        }

        window.deleteData = function(type, day) {
            if (type === 'ganho') {
                delete ganhosData[day];
            } else {
                delete gastosData[day];
            }

            saveDataToStorage();
            createChart();
            updateDataList();

            if (currentUser && currentUser.role === 'cliente') {
                updateStatistics();
            }

            showError(editSuccess, `Dado do dia ${day} removido com sucesso!`);
            setTimeout(() => hideError(editSuccess), 3000);
        };

        function createChart() {
            const ctx = document.getElementById('lineChart').getContext('2d');

            if (chart) {
                chart.destroy();
            }

            const hasGanhos = Object.keys(ganhosData).length > 0;
            const hasGastos = Object.keys(gastosData).length > 0;

            if (!hasGanhos && !hasGastos) {
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: []
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#9CA3AF' }
                            }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: 'Dias', color: '#9CA3AF' },
                                ticks: { color: '#9CA3AF' },
                                grid: { color: '#4B5563' }
                            },
                            y: {
                                title: { display: true, text: 'Valor (R$)', color: '#9CA3AF' },
                                ticks: { color: '#9CA3AF' },
                                grid: { color: '#4B5563' }
                            }
                        }
                    }
                });
                return;
            }

            const allDays = new Set([
                ...Object.keys(ganhosData).map(Number),
                ...Object.keys(gastosData).map(Number)
            ]);
            const maxDay = Math.max(...allDays);
            const labels = Array.from({length: maxDay}, (_, i) => i + 1);

            const datasets = [];

            if (hasGanhos) {
                datasets.push({
                    label: 'üí∞ Ganhos',
                    data: labels.map(day => ganhosData[day] || 0),
                    borderColor: '#3B82F6',
                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: '#3B82F6',
                    pointBorderColor: '#3B82F6',
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    tension: 0.1
                });
            }

            if (hasGastos) {
                datasets.push({
                    label: 'üí∏ Gastos',
                    data: labels.map(day => gastosData[day] || 0),
                    borderColor: '#EF4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    borderWidth: 3,
                    pointBackgroundColor: '#EF4444',
                    pointBorderColor: '#EF4444',
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    tension: 0.1
                });
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#9CA3AF',
                                font: { size: 14, weight: 'bold' }
                            }
                        },
                        tooltip: {
                            backgroundColor: '#374151',
                            titleColor: '#F3F4F6',
                            bodyColor: '#F3F4F6',
                            callbacks: {
                                label: (context) => `${context.dataset.label}: R$ ${context.parsed.y.toFixed(2)}`
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Dias', color: '#9CA3AF' },
                            ticks: { color: '#9CA3AF' },
                            grid: { color: '#4B5563' }
                        },
                        y: {
                            title: { display: true, text: 'Valor (R$)', color: '#9CA3AF' },
                            ticks: { color: '#9CA3AF' },
                            grid: { color: '#4B5563' }
                        }
                    }
                }
            });
        }

        saveGanhoBtn.addEventListener('click', () => saveData('ganho'));
        saveGastoBtn.addEventListener('click', () => saveData('gasto'));

        function saveData(type) {
            hideError(editSuccess);

            const day = parseInt(document.getElementById('editDay').value);
            const value = parseFloat(document.getElementById('editValue').value);

            if (!day || !value) {
                showError(editError, 'Preencha o dia e o valor');
                return;
            }

            if (isNaN(day) || isNaN(value)) {
                showError(editError, 'Digite valores num√©ricos v√°lidos');
                return;
            }

            if (day < 1 || day > 365) {
                showError(editError, 'O dia deve estar entre 1 e 365');
                return;
            }

            if (value < 0) {
                showError(editError, 'O valor n√£o pode ser negativo');
                return;
            }

            if (type === 'ganho') {
                ganhosData[day] = (ganhosData[day] || 0) + value;
            } else {
                gastosData[day] = (gastosData[day] || 0) + value;
            }

            const saved = saveDataToStorage();
            if (!saved) {
                showError(editError, 'Erro ao salvar dados. Tente novamente.');
                return;
            }

            createChart();
            updateDataList();

            if (currentUser && currentUser.role === 'cliente') {
                updateStatistics();
            }

            const tipoText = type === 'ganho' ? 'üí∞ Ganho' : 'üí∏ Gasto';
            const valorAtual = type === 'ganho' ? ganhosData[day] : gastosData[day];
            showError(editSuccess, `${tipoText} adicionado: Dia ${day}, +R$ ${value.toFixed(2)} (Total: R$ ${valorAtual.toFixed(2)})`);
            hideError(editError);

            document.getElementById('editDay').value = '';
            document.getElementById('editValue').value = '';

            setTimeout(() => hideError(editSuccess), 3000);
        }

        function updateStatistics() {
            const hasGanhos = Object.keys(ganhosData).length > 0;
            const hasGastos = Object.keys(gastosData).length > 0;

            if (!hasGanhos && !hasGastos) {
                statistics.innerHTML = '<p style="color: #9CA3AF;">Nenhum dado dispon√≠vel ainda.</p>';
                return;
            }

            let html = '';

            if (hasGanhos) {
                const totalGanhos = Object.values(ganhosData).reduce((sum, val) => sum + val, 0);
                const diasGanho = Object.keys(ganhosData).length;
                html += `
                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #4B5563;">
                        <p style="margin-bottom: 0.5rem; color: #60A5FA; font-weight: bold;">üí∞ GANHOS</p>
                        <p style="margin-bottom: 0.5rem;">Dias com ganhos: ${diasGanho}</p>
                        <p style="margin-bottom: 0.5rem; font-weight: bold; color: #60A5FA;">Total: R$ ${totalGanhos.toFixed(2)}</p>
                    </div>
                `;
            }

            if (hasGastos) {
                const totalGastos = Object.values(gastosData).reduce((sum, val) => sum + val, 0);
                const diasGasto = Object.keys(gastosData).length;
                html += `
                    <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid #4B5563;">
                        <p style="margin-bottom: 0.5rem; color: #F87171; font-weight: bold;">üí∏ GASTOS</p>
                        <p style="margin-bottom: 0.5rem;">Dias com gastos: ${diasGasto}</p>
                        <p style="margin-bottom: 0.5rem; font-weight: bold; color: #F87171;">Total: R$ ${totalGastos.toFixed(2)}</p>
                    </div>
                `;
            }

            if (hasGanhos && hasGastos) {
                const totalGanhos = Object.values(ganhosData).reduce((sum, val) => sum + val, 0);
                const totalGastos = Object.values(gastosData).reduce((sum, val) => sum + val, 0);
                const saldoFinal = totalGanhos - totalGastos;
                const saldoColor = saldoFinal >= 0 ? '#10B981' : '#F87171';
                html += `
                    <div>
                        <p style="margin-bottom: 0.5rem; color: #E5E7EB; font-weight: bold;">üìä SALDO</p>
                        <p style="margin-bottom: 0.5rem; font-weight: bold; font-size: 1.25rem; color: ${saldoColor};">
                            R$ ${saldoFinal.toFixed(2)}                        </p>
                    </div>
                `;
            }

            statistics.innerHTML = html;
        }

        function showError(element, message) {
            element.textContent = message;
            element.classList.remove('hidden');
        }

        function hideError(element) {
            element.classList.add('hidden');
        }
    </script>
</body>
</html>
